@model Warehouse.WebUI.Models.ReceiptIndexViewModel
@{
    ViewData["Title"] = "Поступления";
    var filter = Model.Filter;
    var numbers = Model.Numbers;
    var resources = Model.Resources;
    var units = Model.Units;
}

<h2 class="mb-4">Поступления</h2>

<div class="card shadow-sm mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>Фильтр</span>
        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#filterPanel">
            Показать / Скрыть
        </button>
    </div>
    <div class="collapse @(filter.DateFrom != null || filter.DateTo != null || (filter.Numbers?.Any() ?? false) || (filter.ResourceIds?.Any() ?? false) || (filter.UnitIds?.Any() ?? false) ? "show" : "")" id="filterPanel">
        <div class="card-body">
            <form method="get">
                <div class="row g-3">
                    <div class="col-md-2">
                        <label class="form-label">Период с</label>
                        <input type="date" name="DateFrom" class="form-control" value="@(filter.DateFrom?.ToString("yyyy-MM-dd") ?? "")" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">по</label>
                        <input type="date" name="DateTo" class="form-control" value="@(filter.DateTo?.ToString("yyyy-MM-dd") ?? "")" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Номера документов</label>
                        <select name="Numbers" multiple class="form-select">
                            @foreach (var n in numbers)
                            {
                                var selected = filter.Numbers != null && filter.Numbers.Contains(n);
                                <option value="@n" selected="@(selected ? "selected" : null)">@n</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Ресурсы</label>
                        <select name="ResourceIds" multiple class="form-select">
                            @foreach (var res in resources)
                            {
                                var selected = filter.ResourceIds != null && filter.ResourceIds.Contains(int.Parse(res.Value));
                                <option value="@res.Value" selected="@(selected ? "selected" : null)">@res.Text</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Единицы измерения</label>
                        <select name="UnitIds" multiple class="form-select">
                            @foreach (var unit in units)
                            {
                                var selected = filter.UnitIds != null && filter.UnitIds.Contains(int.Parse(unit.Value));
                                <option value="@unit.Value" selected="@(selected ? "selected" : null)">@unit.Text</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-primary me-2">
                        <i class="bi bi-funnel"></i> Фильтровать
                    </button>
                    <a href="@Url.Action("Index", "Receipt")" class="btn btn-secondary">
                        <i class="bi bi-arrow-clockwise"></i> Сбросить
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="mb-3">
    <a class="btn btn-success" asp-action="Create">
        <i class="bi bi-plus-circle"></i> Добавить поступление
    </a>
</div>

<table class="table table-hover align-middle">
    <thead class="table-dark">
        <tr>
            <th>Номер</th>
            <th>Дата</th>
            <th>Состав</th>
            <th class="text-center">Действия</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var doc in Model.Receipts)
        {
            <tr>
                <td>@doc.Number</td>
                <td>@doc.Date.ToShortDateString()</td>
                <td>
                    <ul class="mb-0">
                        @foreach (var item in doc.Items)
                        {
                            <li>@item.ResourceName — @item.Quantity @item.UnitName</li>
                        }
                    </ul>
                </td>
                <td class="text-center">
                    <a class="btn btn-sm btn-warning me-1" asp-action="Edit" asp-route-id="@doc.Id">
                        <i class="bi bi-pencil"></i> Изменить
                    </a>
                    <a class="btn btn-sm btn-danger" asp-action="Delete" asp-route-id="@doc.Id"
                       onclick="return confirm('Удалить документ?');">
                        <i class="bi bi-trash"></i> Удалить
                    </a>
                </td>
            </tr>
        }
    </tbody>
</table>
